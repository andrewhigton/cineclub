{"ast":null,"code":"var _jsxFileName = \"/Users/andrewhigton/Documents/code/typescript/cineclub/client/src/components/stripe-button/stripe-button.tsx\";\nimport React, { useState } from 'react';\nimport { connect } from 'react-redux';\nimport { useStripe, useElements, CardNumberElement, CardCvcElement, CardExpiryElement } from '@stripe/react-stripe-js';\nimport { updateUserTickets } from '../../actions/auth';\nimport { updateFilm } from '../../actions/film';\nimport Spinner from '../spinner/Spinner';\nimport '../checkout-film/checkoutfilm.css';\nimport axios from 'axios';\n//global vars for dispatch \nlet useHistory;\nlet ticketDataForDispatch;\nlet filmDataForDispatch;\n\nconst StripeCheckoutButton = _ref => {\n  let {\n    filmData,\n    ticketData,\n    price,\n    updateUserTickets,\n    updateFilm,\n    history\n  } = _ref;\n  const stripe = useStripe();\n  const elements = useElements();\n  let [isProcessingPayment, setIsProcessingPayment] = useState(false);\n  useHistory = history;\n  ticketDataForDispatch = ticketData;\n  filmDataForDispatch = filmData;\n\n  const paymentHandler = async e => {\n    e.preventDefault();\n\n    if (!stripe || !elements) {\n      return;\n    }\n\n    isProcessingPayment = true;\n\n    try {\n      var _paymentResult$paymen;\n\n      const response = await axios.post('http://localhost:5000/api/film/payment', {\n        amount: price\n      });\n      const clientSecret = response.data;\n      const cardDetails = elements.getElement(CardNumberElement);\n      if (cardDetails === null) return;\n      const paymentResult = await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: cardDetails,\n          billing_details: {\n            name: 'Andrew Higton'\n          }\n        }\n      });\n\n      if ((paymentResult === null || paymentResult === void 0 ? void 0 : (_paymentResult$paymen = paymentResult.paymentIntent) === null || _paymentResult$paymen === void 0 ? void 0 : _paymentResult$paymen.status) === 'succeeded') {\n        updateUserTickets(ticketDataForDispatch);\n        updateFilm(filmDataForDispatch);\n      }\n\n      setIsProcessingPayment(false);\n    } catch (err) {\n      if (err instanceof Error) {\n        alert(err.message);\n      }\n    }\n  };\n\n  const inputStyle = {\n    fontWeight: '1000',\n    fontSize: '17px',\n    lineHeight: '35px'\n  };\n  return isProcessingPayment ? /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 3\n    }\n  }) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"checkout\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 5\n    }\n  }, \"Card Payment\"), /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: paymentHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(CardNumberElement, {\n    options: {\n      style: {\n        base: inputStyle\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 6\n    }\n  }), /*#__PURE__*/React.createElement(CardExpiryElement, {\n    options: {\n      style: {\n        base: inputStyle\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 6\n    }\n  }), /*#__PURE__*/React.createElement(CardCvcElement, {\n    options: {\n      style: {\n        base: inputStyle\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 6\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    className: \"checkout-button\",\n    disabled: isProcessingPayment,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 6\n    }\n  }, \"Pay Now\")));\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    updateUserTickets: () => dispatch(updateUserTickets(ticketDataForDispatch, useHistory)),\n    updateFilm: () => dispatch(updateFilm(filmDataForDispatch))\n  };\n};\n\nexport default connect(null, mapDispatchToProps)(StripeCheckoutButton);","map":{"version":3,"names":["React","useState","connect","useStripe","useElements","CardNumberElement","CardCvcElement","CardExpiryElement","updateUserTickets","updateFilm","Spinner","axios","useHistory","ticketDataForDispatch","filmDataForDispatch","StripeCheckoutButton","filmData","ticketData","price","history","stripe","elements","isProcessingPayment","setIsProcessingPayment","paymentHandler","e","preventDefault","response","post","amount","clientSecret","data","cardDetails","getElement","paymentResult","confirmCardPayment","payment_method","card","billing_details","name","paymentIntent","status","err","Error","alert","message","inputStyle","fontWeight","fontSize","lineHeight","style","base","mapDispatchToProps","dispatch"],"sources":["/Users/andrewhigton/Documents/code/typescript/cineclub/client/src/components/stripe-button/stripe-button.tsx"],"sourcesContent":["import React, { useState, FormEvent } from 'react';\nimport { connect } from 'react-redux';\nimport {  \n\n\tuseStripe, \n\tuseElements, \n\tCardNumberElement, \n\tCardCvcElement, \n\tCardExpiryElement  \n} from '@stripe/react-stripe-js';\nimport { updateUserTickets } from '../../actions/auth';\nimport { updateFilm } from '../../actions/film';\nimport { ticketType, filmType } from '../../utils/componentTypes';\nimport Spinner from '../spinner/Spinner';\nimport '../checkout-film/checkoutfilm.css'\nimport axios from 'axios';\n\ninterface TicketFilmTypes {\n\tfilmData: filmType;\n\tticketData: ticketType;\n\tprice: number;\n\tupdateUserTickets: (ticketDataForDispatch) => void; \n\tupdateFilm: (filmDataForDispatch) => void; \n\thistory;\n}\n\n//global vars for dispatch \nlet useHistory;\nlet ticketDataForDispatch;\nlet filmDataForDispatch;\n\nconst StripeCheckoutButton: React.FC<TicketFilmTypes> = ({\n\tfilmData, \n\tticketData, \n\tprice,\n\tupdateUserTickets,\n\tupdateFilm,\n\thistory\n\t}) => {\n\nconst stripe = useStripe();\nconst elements = useElements();\n\nlet [isProcessingPayment, setIsProcessingPayment] = useState(false)\n\nuseHistory = history; \nticketDataForDispatch = ticketData;\nfilmDataForDispatch = filmData;\n\nconst paymentHandler = async (e: FormEvent<HTMLFormElement>) => {\n\n\te.preventDefault();\n\tif(!stripe || !elements) {\n\t\treturn;\n\t}\n\n\tisProcessingPayment = true;\n\n\ttry  {\n\tconst response = await axios.post('http://localhost:5000/api/film/payment', {\n  amount: price,\n\t}\n) \n\t\n\t\tconst clientSecret = response.data;\n\n\t\tconst cardDetails = elements.getElement(CardNumberElement)\n\t\t\n\n\t\tif(cardDetails === null) return;\n\n    const paymentResult = await stripe.confirmCardPayment(clientSecret, {\n      payment_method: {\n        card: cardDetails,\n        billing_details: {\n          name: 'Andrew Higton',\n        },\n      },\n    });\n    \n    if(paymentResult?.paymentIntent?.status === 'succeeded') {\n    \tupdateUserTickets(ticketDataForDispatch);\n\t\t\tupdateFilm(filmDataForDispatch); \n\n    }\n    \n    setIsProcessingPayment(false);\t\n\n\t\t} catch (err) {\n\t\t\tif (err instanceof Error) {\n\t\t  alert(err.message);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst inputStyle = {\n      fontWeight: '1000',\n      fontSize: '17px',\n      lineHeight: '35px'\n\t\t}\n\n\treturn isProcessingPayment ? (\n\t\t<Spinner />\n\t\t) : (\n\t\t\t<div className='checkout'>\n\t\t\t\t<h3>Card Payment</h3>\n\t\t\t\t<form onSubmit={paymentHandler}>\n\t\t\t\t\t<CardNumberElement \n\t\t\t\t\toptions={{\n   \t\t\t\t\tstyle: {\n     \t\t\t\t\tbase: inputStyle,\n\t\t\t\t   },\n\t\t\t\t }}\n\t\t\t\t />\n\t\t\t\t\t<CardExpiryElement \n\t\t\t\t\t\toptions={{\n\t   \t\t\t\t\tstyle: {\n\t     \t\t\t\t\tbase: inputStyle,\n\t\t\t\t\t   },\n\t\t\t\t\t }}\n\t\t\t\t\t/>\n\t\t\t\t\t<CardCvcElement \n\t\t\t\t\toptions={{\n   \t\t\t\t\tstyle: {\n     \t\t\t\t\tbase: inputStyle,\n\t\t\t\t\t   },\n\t\t\t\t\t }}\n\t\t\t\t\t/>\n\t\t\t\t\t<button className='checkout-button' \tdisabled={isProcessingPayment}>Pay Now</button>\n\t\t\t\t</form>\n\t\t\t</div>\n\n\t\t )\n\t}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n     updateUserTickets: () => dispatch(updateUserTickets(ticketDataForDispatch, useHistory)),\n     updateFilm: () => dispatch(updateFilm(filmDataForDispatch)) \n  }\n}\n\nexport default connect(null, mapDispatchToProps)(StripeCheckoutButton);"],"mappings":"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"},"metadata":{},"sourceType":"module"}